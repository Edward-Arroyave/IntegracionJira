<h1 style="margin-top: 3em;">Configuración de estadisticas</h1>



<form [formGroup]="formaBuscarDatos" class="form_busqueda">

  <mat-form-field>
    <mat-label>Lote</mat-label>
    <mat-select disableOptionCentering formControlName="lote" (selectionChange)="verTabla = false">
      <mat-option>
        <ngx-mat-select-search [formControl]="filterLotes" placeholderLabel="Buscar lotes..."
          noEntriesFoundLabel="No se encontró un resultado">
        </ngx-mat-select-search>
      </mat-option>
      <mat-option *ngFor="let lote of lotes" [value]="lote.IdLot" [matTooltipPosition]="'right'"
        [matTooltip]="lote.Numlot">
        {{ lote.Numlot }}
      </mat-option>
    </mat-select>
  </mat-form-field>



  <mat-form-field>
    <mat-label>Programa</mat-label>
    <mat-select disableOptionCentering formControlName="programa" (selectionChange)="getAnalitosxPrograma($event)">
      <mat-option>
        <ngx-mat-select-search [formControl]="filterPrograma" placeholderLabel="Buscar programa..."
          noEntriesFoundLabel="No se encontró un resultado">
        </ngx-mat-select-search>
      </mat-option>
      <mat-option *ngFor="let programa of listaProgramas" [value]="programa.IdProgram" [matTooltipPosition]="'right'"
        [matTooltip]="programa.Desprogram">
        {{ programa.Desprogram }}
      </mat-option>
    </mat-select>
  </mat-form-field>


  <div>
    <button type="button" class="btnPurple-01" (click)="buscar()" [disabled]="formaBuscarDatos.invalid">
      Buscar<mat-icon>search</mat-icon></button>
  </div>
</form>


<div>
  <div class="filtros-flex">
    <div class="crear-estados">
      <button class="btnPurple-01" type="button" (click)="modalCrear(crearOeditar)">
        {{ 'Crear' | translate}}
        <mat-icon>note_add</mat-icon>
      </button>

      <div class="cont-estados">
        <div class="desc-estado">
          <div class="circle blue"></div>
          Todos los resultados
        </div>
        <div class="desc-estado">
          <div class="circle pink"></div>
          Equipo - Método
        </div>
        <div class="desc-estado">
          <div class="circle orange"></div>
          Método
        </div>
      </div>

    </div>

    <mat-form-field>
      <mat-label>{{'Buscar' | translate}}</mat-label>
      <input matInput (keyup)="aplicarFiltro($event)" #input>
      <mat-icon matSuffix class="icon-search">search</mat-icon>
    </mat-form-field>
  </div>


  <table mat-table [dataSource]="dataSource" matSort>

    <ng-container matColumnDef="desanalytes">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Analito</th>
      <td mat-cell *matCellDef="let row"> {{row.desanalytes}} </td>
    </ng-container>

    <ng-container matColumnDef="nameAnalyzer">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Analizador</th>
      <td mat-cell *matCellDef="let row"> {{row.nameAnalyzer}} </td>
    </ng-container>

    <ng-container matColumnDef="desmethods">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Método</th>
      <td mat-cell *matCellDef="let row"> {{row.desmethods}} </td>
    </ng-container>

    <ng-container matColumnDef="codunits">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Unidad</th>
      <td mat-cell *matCellDef="let row"> {{row.codunits}} </td>
    </ng-container>

    <ng-container matColumnDef="average">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Media</th>
      <td mat-cell *matCellDef="let row">{{ row.average }}</td>
    </ng-container>

    <ng-container matColumnDef="ds">
      <th mat-header-cell *matHeaderCellDef  mat-sort-header>Desviación</th>
      <td mat-cell *matCellDef="let row">{{row.ds}}</td>
    </ng-container>

    <ng-container matColumnDef="totalData">
      <th mat-header-cell *matHeaderCellDef  mat-sort-header>N. Total datos</th>
      <td mat-cell *matCellDef="let row">{{row.totalData}}</td>
    </ng-container>

    <ng-container matColumnDef="estado">
      <th mat-header-cell *matHeaderCellDef>Estado</th>
      <td mat-cell *matCellDef="let row">
        <mat-slide-toggle [checked]="row.active" (change)="editarToggle($event,row)"></mat-slide-toggle>
      </td>
    </ng-container>

    <ng-container matColumnDef="editar">
      <th mat-header-cell *matHeaderCellDef>Editar</th>
      <td mat-cell *matCellDef="let row">
        <div class="editarIcon" (click)="modalEditar(crearOeditar,row)" >
          <mat-icon style="font-size: 21px;">edit</mat-icon>
        </div>
      </td>
    </ng-container>

    <ng-container matColumnDef="borrar">
      <th mat-header-cell *matHeaderCellDef>
        Eliminar</th>
      <td mat-cell *matCellDef="let row; let i = index;">
        <div class="eliminarIcon" (click)="eliminarConfEstadisticaGeneral(row.idGeneralStatisticalValues)">
          <mat-icon>close</mat-icon>
      </div>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr [ngClass]="borderTypeColor(row.measuringsystem)" mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

    <tr class="mat-row" *matNoDataRow>

    </tr>
  </table>
  <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]"></mat-paginator>
</div>




<ng-template #crearOeditar>

  <form [formGroup]="formCrearEditar" class="formulario">

    <div class=" contenedor_1">
      <mat-form-field>
        <mat-label>Sistema Medición<span class="colorAsterisco"> *</span>
        </mat-label>
        <mat-select formControlName="Measuringsystem" (selectionChange)="cambiarEstadoforms($event.value)">
          <mat-option value="EM">Equipo-Método</mat-option>
          <mat-option value="M">Método</mat-option>
          <mat-option value="T">Todos los resultados</mat-option>
        </mat-select>
      </mat-form-field>

      <div style="display: flex;justify-content: left; margin-left: 1em;">
        <mat-slide-toggle formControlName="active" labelPosition="before"> Activo </mat-slide-toggle>
      </div>
    </div>


    <div class="contenedor_2">


      <mat-form-field *ngIf="obtenerAccion === 'EM' || obtenerAccion === 'T' || obtenerAccion === 'M'">
        <mat-label>Analito</mat-label>
        <mat-select formControlName="idAnalytes">
          <mat-option>
            <ngx-mat-select-search [formControl]="filterAnalytes" placeholderLabel="Buscar analito..."
              noEntriesFoundLabel="No se encontró un resultado">
            </ngx-mat-select-search>
          </mat-option>
          <mat-option *ngFor="let analito of analitos" [value]="analito.idanalytes" [matTooltipPosition]="'right'"
            [matTooltip]="analito.desanalytes">
            {{ analito.desanalytes}}
          </mat-option>
        </mat-select>
        <mat-error>Obligatorio</mat-error>
      </mat-form-field>



      <mat-form-field style="margin-bottom: 0.6em;" *ngIf="obtenerAccion === 'EM'">
        <mat-label>Equipo</mat-label>
        <mat-select formControlName="idAnalyzer">
          <mat-option>
            <ngx-mat-select-search [formControl]="filterAnalizer" placeholderLabel="Buscar equipo..."
              noEntriesFoundLabel="No se encontró un resultado">
            </ngx-mat-select-search>
          </mat-option>
          <mat-option *ngFor="let analizador of analyzers" [value]="analizador.idAnalyzer">
            {{ analizador.nameAnalyzer }}
          </mat-option>
        </mat-select>
        <mat-error>Obligatorio</mat-error>
      </mat-form-field>

      <mat-form-field *ngIf="obtenerAccion === 'EM' || obtenerAccion === 'M'" style="margin-bottom: 0.6em;">
        <mat-label>Metodo</mat-label>
        <mat-select formControlName="idMethods">
          <mat-option>
            <ngx-mat-select-search [formControl]="filterMetodo" placeholderLabel="Buscar metodo..."
              noEntriesFoundLabel="No se encontró un resultado">
            </ngx-mat-select-search>
          </mat-option>
          <mat-option *ngFor="let metodo of methodsActive" [value]="metodo.idmethods">
            {{ metodo.desmethods }}
          </mat-option>
        </mat-select>
        <mat-error>Obligatorio</mat-error>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Media</mat-label>
        <input matInput type="number" formControlName="average">
        <mat-error>Obligatorio</mat-error>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Desviación </mat-label>
        <input matInput type="number" formControlName="ds">
        <mat-error>Obligatorio</mat-error>
      </mat-form-field>

      <mat-form-field>
        <mat-label>N. Total datos</mat-label>
        <input matInput type="number" formControlName="totalData">
        <mat-error>Obligatorio</mat-error>
      </mat-form-field>

      <mat-form-field>
        <mat-label for="Measuringsystem">Unidades de medida<span class="colorAsterisco"> *</span>
        </mat-label>
        <mat-select formControlName="idunits">
          <mat-option>
            <ngx-mat-select-search [formControl]="filterUnits" placeholderLabel="Buscar unidades..."
              noEntriesFoundLabel="No se encontró un resultado">
            </ngx-mat-select-search>
          </mat-option>
          <mat-option *ngFor="let item of listaUnidades" [value]="item.idunits">{{item.codunits}}</mat-option>
        </mat-select>
        <mat-error>Obligatorio</mat-error>
      </mat-form-field>



    </div>

  </form>




</ng-template>
