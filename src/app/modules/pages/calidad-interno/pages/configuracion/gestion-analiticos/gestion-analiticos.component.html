  <app-tabla-comun [cabeceros]="displayedColumns" [info-tabla]="dataTableBody" [titulo]="'Analitos'"
    (onCreate)="openModalGestionAnaliticos(templateGestionAnaliticos, '')" (onChangeStatus)="actualizarGestionAnaliticos($event)"
    (onEdit)="openModalGestionAnaliticos(templateGestionAnaliticos, $event)" (onDelete)="eliminarGestionAnaliticos($event)"
    (onPermissions)="modalPrecarga(templatePrecarga, $event)">
  </app-tabla-comun>

<ng-template #templateGestionAnaliticos>

  <form [formGroup]="formaGestionAnaliticos" class="grid-3">

    <mat-form-field>
      <mat-label>Nombre</mat-label>
      <input matInput type="text" formControlName="desanalytes">
      <mat-error>Obligatorio</mat-error>
    </mat-form-field>

    <mat-form-field>
      <mat-label>Nivel</mat-label>
      <input matInput type="number" formControlName="nivels">
      <mat-error>Maximo hasta el nivel 3</mat-error>
    </mat-form-field>

    <!-- <mat-form-field>
      <mat-label>
        Secci贸n
      </mat-label>
      <input type="text" matInput [matAutocomplete]="autounitscreate" formControlName="idsection">
      <mat-autocomplete #autounitscreate="matAutocomplete">
        <mat-option>
          <ngx-mat-select-search [formControl]="filterSection" placeholderLabel="Buscar..."
            noEntriesFoundLabel="No se encontr贸 un resultado">
          </ngx-mat-select-search>
        </mat-option>
        <mat-option *ngFor="let section of filteredOptionsSectionCreate | async" [value]="section.namesection">
          {{ section.namesection | titlecase }}
        </mat-option>
      </mat-autocomplete>
      <mat-error>Obligatorio</mat-error>
    </mat-form-field> -->

    <mat-form-field>
      <mat-label for="idsection">
        Secci贸n
      </mat-label>
      <mat-select disableOptionCentering formControlName="idsection">
        <mat-option value="">--</mat-option>
        <mat-option>
          <ngx-mat-select-search [formControl]="filterSection" placeholderLabel="Buscar..."
            noEntriesFoundLabel="No se encontr贸 un resultado">
          </ngx-mat-select-search>
        </mat-option>
        <mat-option *ngFor="let section of sectionsActive" [value]="section.idsection">
          {{ section.namesection | titlecase }}
        </mat-option>
      </mat-select>
      <mat-error>Obligatorio</mat-error>
    </mat-form-field>

    <mat-form-field>
      <mat-label>
        Tipo resultado
      </mat-label>
      <mat-select disableOptionCentering  formControlName="resulttype">
        <mat-option value="">
          --
        </mat-option>
        <mat-option value="N">Cuantitativo</mat-option>
        <mat-option value="C">Cualitativo</mat-option>
      </mat-select>
      <mat-error>Obligatorio</mat-error>
    </mat-form-field>

    <div class="contieneToggle">
      <label class="labelToggle">Estado</label>
      <mat-slide-toggle formControlName="active" labelPosition="top"></mat-slide-toggle>
    </div>

  </form>
</ng-template>


<ng-template #templatePrecarga>

  <form [formGroup]="miFormPrecarga" class="grid-6-toggle">
    <mat-form-field >
      <mat-label>Etpm</mat-label>
      <input type="number" matInput formControlName="etmp">
      <mat-error *ngIf="miFormPrecarga.get('etmp')?.invalid && miFormPrecarga.get('etmp')?.touched">*Obligatorio</mat-error>
    </mat-form-field>

    <mat-form-field >
      <mat-label>Cvmp</mat-label>
      <input type="number" matInput formControlName="cvmp">
      <mat-error *ngIf="miFormPrecarga.get('cvmp')?.invalid && miFormPrecarga.get('cvmp')?.touched">*Obligatorio</mat-error>
    </mat-form-field>
    
    <mat-form-field >
      <mat-label>Sesgo mp</mat-label>
      <input type="number" matInput formControlName="sesgomp">
      <mat-error *ngIf="miFormPrecarga.get('sesgomp')?.invalid && miFormPrecarga.get('sesgomp')?.touched">*Obligatorio</mat-error>
    </mat-form-field>

    <mat-form-field >
      <mat-label>Fuente</mat-label>
      <input type="text" matInput [matAutocomplete]="autosourcecreate" formControlName="nameSource">
      <mat-autocomplete #autosourcecreate="matAutocomplete">
        <mat-option *ngFor="let fuente of filteredOptionsSourcesCreate | async" 
                    [value]="fuente.dessource">
          {{fuente.dessource}}
        </mat-option>
      </mat-autocomplete>
      <mat-error *ngIf="miFormPrecarga.get('nameSource')?.invalid && miFormPrecarga.get('idsource')?.touched">*Obligatorio</mat-error>
    </mat-form-field>

    <mat-form-field >
      <mat-label>Unidades</mat-label>
      <input type="text" matInput [matAutocomplete]="autounitscreate" formControlName="nameUnit">
      <mat-autocomplete #autounitscreate="matAutocomplete" >
        <mat-option *ngFor="let units of filteredOptionsUnitsCreate | async" 
                      [value]="units.desunits">
          {{ units.desunits}}
        </mat-option>
      </mat-autocomplete>
      <mat-error *ngIf="miFormPrecarga.get('nameUnit')?.invalid && miFormPrecarga.get('idunits')?.touched">*Obligatorio</mat-error>
    </mat-form-field>

    <div class="contieneToggle">
      <label class="labelToggle">Estado</label>
      <mat-slide-toggle formControlName="active" labelPosition="top"></mat-slide-toggle>
    </div>

    <div>
      <button [disabled]="miFormPrecarga.invalid" (click)="guardarEditarPrecarga()" class="btnPurple-01">
        {{precargaBtnText()}}
        <mat-icon>save</mat-icon>
      </button>
    </div>

  </form>


  <div >
    <div *ngIf="dataSourcePrecarga?.data.length !== 0">
      
      <table #table2 mat-table [dataSource]="dataSourcePrecarga" matSort >
            
        <ng-container  matColumnDef="etmp">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Etpm</th>
          <td mat-cell *matCellDef="let row">{{row.etmp}}</td>
        </ng-container>

        <ng-container  matColumnDef="cvmp">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Cvmp</th>
          <td mat-cell *matCellDef="let row">{{row.cvmp}}</td>
        </ng-container>

        <ng-container  matColumnDef="sesgomp">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Sesgo mp</th>
          <td mat-cell *matCellDef="let row">{{row.sesgomp}}</td>
        </ng-container>

        <ng-container  matColumnDef="idsource">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Fuente</th>
          <td mat-cell *matCellDef="let row">{{row.nameSource}}</td>
        </ng-container>

        <ng-container  matColumnDef="idunits">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Unidades</th>
          <td mat-cell *matCellDef="let row">{{row.nameUnit}}</td>
        </ng-container>

        <ng-container  matColumnDef="active">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Estado</th>
          <td mat-cell *matCellDef="let row">
            <mat-slide-toggle (change)="editarEstado(row)"  [checked]="row.active"></mat-slide-toggle>
          </td>
        </ng-container>

        <ng-container  matColumnDef="editar">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Editar</th>
          <td mat-cell *matCellDef="let row">
            <div class="editarIcon" (click)="prepararEdicion(row)">
              <mat-icon style="font-size: 21px;">edit</mat-icon> 
            </div>
          </td>
        </ng-container>
        <ng-container  matColumnDef="eliminar">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Eliminar</th>
          <td mat-cell *matCellDef="let row">
            <div class="eliminarIcon" (click)="eliminarPrecarga(row.idpreloadmetquality)" >
              <mat-icon>close</mat-icon>
            </div>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="headersPrecargar"></tr>
        <tr mat-row *matRowDef="let row; columns: headersPrecargar;"></tr>
      </table>
    </div>
    <mat-paginator [pageSizeOptions]="[3]"></mat-paginator>
  </div>
</ng-template>

